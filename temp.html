<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FAT2FIT</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script>
        function validation() {
            const username = document.login.UserName.value;
            const password = document.login.password.value;
            let flag = true; //valid is ok
            if (username === '') {
                document.getElementById('usernameValid').innerHTML = 'user name is empty, please put a username';
                flag = false;
            }
            let answer=testLogInSubmit(username, password);
            if (answer === false) {
                document.getElementById('errorValid').innerHTML = 'user name or password is incorrect';
                flag = false;
            } else {
                document.getElementById('errorValid').innerHTML = '';
            }
            if (password === '') {
                document.getElementById('passwordValid').innerHTML = 'password is empty, please put a password';
                flag = false;
            } else {
                if (password.length <= 5) {
                    document.getElementById('passwordValid').innerHTML = 'password is short, please choose a longer password';
                    flag = false;
                }
                else{
                    document.getElementById('passwordValid').innerHTML = '';

                }
            }
            return flag;
        }

        let request;
        if (navigator.appName === 'Microsoft Internet Explorer') {
            request = new ActiveXObject('Microsoft.XMLHTTP');
        } else {
            request = new XMLHttpRequest();
        }

        function testLogInSubmit(username, password) {
            request.abort();
            request.open('GET', 'http://10.0.2.2:8080:8080/controller/UserController/testLogIn?userName=' + username + '&password=' + password, false);
            let flag = true;
            request.onreadystatechange = function () {
                if (request.readyState === 4 && request.status === 200) {
                    if (request.responseText === 'false') //the test failed
                        flag = false;
                }
            };
            request.send(null);
            return flag;
        }
    </script>
</head>
<body>
<form name="login" method="post" action="http://10.0.2.2:8080/controller/UserController/login" data-ajax="false"
      onsubmit="return validation();">
    <div data-role="dialog" id="login">
        <div data-role="header" data-position="fixed">
            <h1 style="color: black">Welcome to FAT2FIT</h1>
        </div>
        <div data-role="content" style="background: #d3d3d3">
            <div data-role="fieldcontain">
                <label for="UserName" style="color: black; font-size: large ">user name:</label>
                <input type="text" name="UserName" id="UserName" value="" style="background: white"/>
                <div id="usernameValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="password" style="color: black; font-size: large">password:</label>
                <input type="password" name="password" id="password" value="" autocomplete="off"
                       style="background: white"/>
                <div id="passwordValid" style="color: #e9080d"></div>
            </div>
            <div id="errorValid" style="color: #e9080d"></div>
            <div data-role="fieldcontain">
                <input type="submit" name="submit" value="Log In"/>
            </div>
            <div>
                <a href="SignUp.html" data-rel="dialog" data-transition="pop" data-ajax="false"
                   style="color: black; font-size: large;"> Don't have a FAT2FIT account? create
                    yours now</a>
            </div>
            <div data-role="footer" data-position="fixed">
                <h3>FAT2FIT</h3>
            </div>
        </div>
    </div>
</form>
</body>
</html>