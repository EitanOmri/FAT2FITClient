<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FAT2FIT</title>
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script>function validation() {
        const username = document.signup.UserName.value;
        const firstname = document.signup.firstName.value;
        const lastname = document.signup.lastName.value;
        const email = document.signup.email.value;
        const password = document.signup.password.value;
        const confirmpassword = document.signup.confirmPassword.value;
        const date = document.signup.birthday.value;
        const height = document.signup.height.value;
        const weight = document.signup.weight.value;
        let flag = true;
        if (username === '') {
            document.getElementById('usernameValid').innerHTML = 'user name is empty, please put a username ';
            flag = false;
        }
        if (isUserExistOnSubmit(username))
            flag = false;
        if (document.signup.checkbox.checked === false) {
            alert('you must agree to our terms');
            flag = false;
        }
        if (firstname === '') {
            document.getElementById('firstnameValid').innerHTML = 'first name is empty, please put a first name ';
            flag = false;
        }
        if (lastname === '') {
            document.getElementById('lastnameValid').innerHTML = 'last name is empty, please put a last name ';
            flag = false;
        }
        if (email === '') {
            document.getElementById('emailValid').innerHTML = 'email is empty, please put an email ';
            flag = false;
        }
        if (password === '') {
            document.getElementById('passwordValid').innerHTML = 'password is empty, please put a password ';
            flag = false;
        } else {
            if (password.length <= 5) {
                document.getElementById('passwordValid').innerHTML = 'password is short, please choose a longer password ';
                flag = false;
            }
        }
        if (confirmpassword === '') {
            document.getElementById('confirmpasswordValid').innerHTML = 'confirm password is empty, please put a confirm password ';
            flag = false;

        } else {
            if (confirmpassword.localeCompare(password)) {
                document.getElementById('confirmpasswordValid').innerHTML = 'confirm password is not the same, please put a correct confirm password ';
                flag = false;
            }
        }
        if (date === '') {
            document.getElementById('birthdayValid').innerHTML = 'birthday is empty, please put a birthday';
            flag = false;
        }
        if (height === '') {
            document.getElementById('heightValid').innerHTML = 'height is empty, please put a height';
            flag = false;
        }
        if (weight === '') {
            document.getElementById('weightValid').innerHTML = 'weight is empty, please put a height';
            flag = false;
        }
        return flag;
    }

    let request;
    if (navigator.appName === 'Microsoft Internet Explorer') {
        request = new ActiveXObject('Microsoft.XMLHTTP');
    } else {
        request = new XMLHttpRequest();
    }

    function isUserExist(username) {
        request.abort();
        request.open('GET', 'http://10.0.2.2:8080/controller/UserController/isExistUserName?userName=' + username, true);
        request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
                let str = '';
                if (request.responseText === 'true') //the username already exist
                    str = 'the username already exist';
                document.getElementById('usernameValid').innerHTML = str;
            }
        };
        request.send(null);
    }

    function isUserExistOnSubmit(username) {
        request.abort();
        request.open('GET', 'http://10.0.2.2:8080/controller/UserController/isExistUserName?userName=' + username, true);
        let flag = false;
        request.onreadystatechange = function () {
            if (request.readyState === 4 && request.status === 200) {
                if (request.responseText === 'true') //the username already exist
                    flag = true;
            }
        };
        request.send(null);
        return flag;
    }
    </script>
</head>
<body>
<form name="signup" method="post" action="http://localhost:8080/controller/UserController/addUser"
      onsubmit="return validation()">
    <div data-role="page" id="SignUp">
        <div data-role="header" data-position="fixed">
            <a href="Login.html" data-role="button" data-icon="back" class="ui-btn-left">back to Login</a>
            <h1 style="color: black">Create your account</h1>
        </div>
        <div data-role="content" style="background: #d3d3d3">
            <div data-role="fieldcontain">
                <label for="UserName" style="color: black; font-size: large">user name:</label>
                <input type="text" name="UserName" id="UserName" value="" onkeyup="isUserExist(this.value)"/>
                <div id="usernameValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="firstName" style="color: black; font-size: large"> first name:</label>
                <input type="text" name="firstName" id="firstName" value=""/>
                <div id="firstnameValid" style="color: #e9080d"></div>

            </div>
            <div data-role="fieldcontain">
                <label for="lastName" style="color: black; font-size: large">last name:</label>
                <input type="text" name="lastName" id="lastName" value=""/>
                <div id="lastnameValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="email" style="color: black; font-size: large">e-mail:</label>
                <input type="email" name="email" id="email" value=""/>
                <div id="emailValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="password" style="color: black; font-size: large">password:</label>
                <input type="password" name="password" id="password" value="" autocomplete="off"/>
                <div id="passwordValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="password" style="color: black; font-size: medium"> confirm password:</label>
                <input type="password" name="confirmPassword" id="confirmPassword" value="" autocomplete="off"/>
                <div id="confirmpasswordValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain" style="color: black; font-size: medium">
                <label for="birthday">birthday:</label>
                <input type="date" name="birthday" id="birthday" value=""/>
                <div id="birthdayValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="height" style="color: black; font-size: large">height:</label>
                <input type="number" name="height" id="height" value=""/>
                <div id="heightValid" style="color: #e9080d"></div>
            </div>
            <div data-role="fieldcontain">
                <label for="weight" style="color: black; font-size: large">weight:</label>
                <input type="number" name="weight" id="weight" value=""/>
                <div id="weightValid" style="color: #e9080d"></div>
            </div>
            <fieldset data-role="controlgroup">
                <legend style="color: black; font-size: large">By Registering, you agree that you've read and accepted
                    our <a href="Check.html" data-rel="dialog" data-transition="pop">User Agreement,</a>
                    you're at least 18 years old, and you consent to our Privacy Notice and receiving marketing
                    communications from us.
                </legend>
                <label for="checkbox">I agree</label>
                <input type="checkbox" name="checkbox" id="checkbox">
            </fieldset>
            <div data-role="fieldcontain">
                <input type="submit" name="submit" value="Sign Up"/>
            </div>

            <div data-role="footer" data-position="fixed">
                <h3>FAT2FIT</h3>
            </div>
        </div>
    </div>
</form>
</body>
</html>